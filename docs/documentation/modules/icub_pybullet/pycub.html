

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>icub_pybullet.pycub &mdash; pyCub  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=9edc463e" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            pyCub
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">pyCub Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html#exercises">Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html#icub-pybullet">icub_pybullet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html#id7">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyCub</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">icub_pybullet.pycub</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for icub_pybullet.pycub</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The main class and utils for pyCub simulator</span>

<span class="sd">:Author: Lukas Rustler</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pybullet</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">p</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pybullet_utils.bullet_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">BulletClient</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">icub_pybullet.visualizer</span><span class="w"> </span><span class="kn">import</span> <span class="n">Visualizer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">icub_pybullet.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">Config</span><span class="p">,</span> <span class="n">URDF</span><span class="p">,</span> <span class="n">Pose</span><span class="p">,</span> <span class="n">CustomFormatter</span><span class="p">,</span> <span class="n">JOINTS</span><span class="p">,</span> <span class="n">JOINTS_IDS</span><span class="p">,</span> <span class="n">CHAINS</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">visualizer</span><span class="w"> </span><span class="kn">import</span> <span class="n">Visualizer</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">Config</span><span class="p">,</span> <span class="n">URDF</span><span class="p">,</span> <span class="n">Pose</span><span class="p">,</span> <span class="n">CustomFormatter</span><span class="p">,</span> <span class="n">JOINTS</span><span class="p">,</span> <span class="n">JOINTS_IDS</span><span class="p">,</span> <span class="n">CHAINS</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">open3d</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">o3d</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">atexit</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">roboticstoolbox</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rtb</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">open3d.core</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">o3c</span>


<div class="viewcode-block" id="Joint">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.Joint">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Joint</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">robot_joint_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">joints_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">lower_limit</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">upper_limit</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">max_force</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">max_velocity</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Help class to encapsulate joint information</span>

<span class="sd">        :param name: name of the joint</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :param robot_joint_id: id of the joint in pybullet</span>
<span class="sd">        :type robot_joint_id: int</span>
<span class="sd">        :param joints_id: id of the joint in pycub.joints</span>
<span class="sd">        :type joints_id: int</span>
<span class="sd">        :param lower_limit: lower limit of the joint</span>
<span class="sd">        :type lower_limit: float</span>
<span class="sd">        :param upper_limit: upper limit of the joint</span>
<span class="sd">        :type upper_limit: float</span>
<span class="sd">        :param max_force: max force of the joint</span>
<span class="sd">        :type max_force: float</span>
<span class="sd">        :param max_velocity: max velocity of the joint</span>
<span class="sd">        :type max_velocity: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot_joint_id</span> <span class="o">=</span> <span class="n">robot_joint_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joints_id</span> <span class="o">=</span> <span class="n">joints_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lower_limit</span> <span class="o">=</span> <span class="n">lower_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upper_limit</span> <span class="o">=</span> <span class="n">upper_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_force</span> <span class="o">=</span> <span class="n">max_force</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_velocity</span> <span class="o">=</span> <span class="n">max_velocity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_point</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Joint </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with id </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">robot_joint_id</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="Link">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.Link">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Link</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">robot_link_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">urdf_link</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Help function to encapsulate link information</span>

<span class="sd">        :param name: name of the link</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :param robot_link_id: id of the link in pybullet</span>
<span class="sd">        :type robot_link_id: int</span>
<span class="sd">        :param urdf_link: id of the link in pycub.urdfs[&quot;robot&quot;].links</span>
<span class="sd">        :type urdf_link: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot_link_id</span> <span class="o">=</span> <span class="n">robot_link_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">urdf_link</span> <span class="o">=</span> <span class="n">urdf_link</span></div>



<div class="viewcode-block" id="pyCub">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">pyCub</span><span class="p">(</span><span class="n">BulletClient</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Client class which inherits from BulletClient and contains the whole simulation functionality</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># As dict, because IntEnum is about 1.5-2x slower</span>
    <span class="n">jointInfo</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;INDEX&quot;</span><span class="p">,</span> <span class="s2">&quot;NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;TYPE&quot;</span><span class="p">,</span> <span class="s2">&quot;QINDEX&quot;</span><span class="p">,</span> <span class="s2">&quot;UINDEX&quot;</span><span class="p">,</span> <span class="s2">&quot;FLAGS&quot;</span><span class="p">,</span> <span class="s2">&quot;DAMPING&quot;</span><span class="p">,</span>
                                                   <span class="s2">&quot;FRICTION&quot;</span><span class="p">,</span> <span class="s2">&quot;LOWERLIMIT&quot;</span><span class="p">,</span> <span class="s2">&quot;UPPERLIMIT&quot;</span><span class="p">,</span> <span class="s2">&quot;MAXFORCE&quot;</span><span class="p">,</span> <span class="s2">&quot;MAXVELOCITY&quot;</span><span class="p">,</span>
                                                   <span class="s2">&quot;LINKNAME&quot;</span><span class="p">,</span> <span class="s2">&quot;AXIS&quot;</span><span class="p">,</span> <span class="s2">&quot;PARENTPOS&quot;</span><span class="p">,</span> <span class="s2">&quot;PARENTORN&quot;</span><span class="p">,</span> <span class="s2">&quot;PARENTINDEX&quot;</span><span class="p">])}</span>
    <span class="n">jointStates</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;POSITION&quot;</span><span class="p">,</span> <span class="s2">&quot;VELOCITY&quot;</span><span class="p">,</span> <span class="s2">&quot;FORCES&quot;</span><span class="p">,</span> <span class="s2">&quot;TORQUE&quot;</span><span class="p">])}</span>

    <span class="n">linkInfo</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;WORLDPOS&quot;</span><span class="p">,</span> <span class="s2">&quot;WORLDORI&quot;</span><span class="p">,</span> <span class="s2">&quot;INERTIAPOS&quot;</span><span class="p">,</span> <span class="s2">&quot;INERTIAORI&quot;</span><span class="p">,</span> <span class="s2">&quot;URDFPOS&quot;</span><span class="p">,</span>
                                                  <span class="s2">&quot;URDFORI&quot;</span><span class="p">,</span> <span class="s2">&quot;LINVEL&quot;</span><span class="p">,</span> <span class="s2">&quot;ANGVEL&quot;</span><span class="p">])}</span>

    <span class="n">contactPoints</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;FLAG&quot;</span><span class="p">,</span> <span class="s2">&quot;IDA&quot;</span><span class="p">,</span> <span class="s2">&quot;IDB&quot;</span><span class="p">,</span> <span class="s2">&quot;INDEXA&quot;</span><span class="p">,</span> <span class="s2">&quot;INDEXB&quot;</span><span class="p">,</span> <span class="s2">&quot;POSITIONA&quot;</span><span class="p">,</span>
                                                       <span class="s2">&quot;POSITIONB&quot;</span><span class="p">,</span> <span class="s2">&quot;NORMAL&quot;</span><span class="p">,</span> <span class="s2">&quot;DISTANCE&quot;</span><span class="p">,</span> <span class="s2">&quot;FORCE&quot;</span><span class="p">,</span>
                                                       <span class="s2">&quot;FRICTION1&quot;</span><span class="p">,</span> <span class="s2">&quot;FRICTIONDIR1&quot;</span><span class="p">,</span> <span class="s2">&quot;FRICTION2&quot;</span><span class="p">,</span> <span class="s2">&quot;FRICTIONDIR2&quot;</span><span class="p">])}</span>
    <span class="n">dynamicsInfo</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;MASS&quot;</span><span class="p">,</span> <span class="s2">&quot;FRICTION&quot;</span><span class="p">,</span> <span class="s2">&quot;INTERTIADIAGONAL&quot;</span><span class="p">,</span> <span class="s2">&quot;INERTIAPOS&quot;</span><span class="p">,</span> <span class="s2">&quot;INERTIAOR&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;RESTITUTION&quot;</span><span class="p">,</span> <span class="s2">&quot;ROLLINGFRICTION&quot;</span><span class="p">,</span> <span class="s2">&quot;SPINNINGFRICTION&quot;</span><span class="p">,</span> <span class="s2">&quot;DAMPING&quot;</span><span class="p">,</span>
                                                      <span class="s2">&quot;STIFFNESS&quot;</span><span class="p">,</span> <span class="s2">&quot;BODYTYPE&quot;</span><span class="p">,</span> <span class="s2">&quot;MARGIN&quot;</span><span class="p">])}</span>
    <span class="n">visualShapeData</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="s2">&quot;GEOMTYPE&quot;</span><span class="p">,</span> <span class="s2">&quot;DIMS&quot;</span><span class="p">,</span> <span class="s2">&quot;FILE&quot;</span><span class="p">,</span> <span class="s2">&quot;POS&quot;</span><span class="p">,</span> <span class="s2">&quot;ORI&quot;</span><span class="p">,</span>
                                                         <span class="s2">&quot;COLOR&quot;</span><span class="p">,</span> <span class="s2">&quot;TEXTURE&quot;</span><span class="p">])}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default.yaml&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param config: path to the config file</span>
<span class="sd">        :type config: str, optional, default=&quot;default.yaml&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">DIRECT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">c_path</span> <span class="ow">in</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_dir</span><span class="p">,</span> <span class="s2">&quot;configs&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">),</span> <span class="n">config</span><span class="p">,</span>
                       <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">config</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">c_path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">c_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">simulation_step</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">simulation_step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTimeStep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">simulation_step</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">standard</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">web</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">standard</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">web</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">web</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kill_open3d</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_step</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_step</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;pycub_logger&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">debug</span> <span class="k">else</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
        <span class="n">stream_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
        <span class="n">stream_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">CustomFormatter</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">stream_handler</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;log_pose&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_pose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">log_pose</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pose_logger</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_pose</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gravity</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">urdf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">robot_urdf_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">urdfs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;robot&quot;</span><span class="p">:</span> <span class="n">URDF</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urdf_path</span><span class="p">)}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vhacd</span><span class="o">.</span><span class="n">use_vhacd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_vhacd</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">urdf_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">urdfs</span><span class="p">[</span><span class="s2">&quot;robot&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free_objects</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_robot</span><span class="p">()</span>

        <span class="c1"># prepare IK config so we can utilize null space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IK_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;movable_joints&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">joints_id</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span> <span class="k">if</span> <span class="s2">&quot;_hand_&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_</span><span class="o">.</span><span class="n">name</span><span class="p">],</span>
                          <span class="s2">&quot;lower_limits&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">lower_limit</span> <span class="o">+</span> <span class="mf">0.025</span><span class="o">*</span><span class="n">_</span><span class="o">.</span><span class="n">lower_limit</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">],</span>
                          <span class="s2">&quot;upper_limits&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">upper_limit</span> <span class="o">-</span> <span class="mf">0.025</span><span class="o">*</span><span class="n">_</span><span class="o">.</span><span class="n">upper_limit</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">],</span>
                          <span class="s2">&quot;joint_ranges&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">upper_limit</span> <span class="o">-</span> <span class="n">_</span><span class="o">.</span><span class="n">lower_limit</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">],</span>
                          <span class="s2">&quot;rest_poses&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">initial_joint_angles</span><span class="p">,</span> <span class="n">_</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                                         <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">initial_joint_angles</span><span class="p">,</span> <span class="n">_</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                                         <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">]}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end_effector</span> <span class="o">=</span> <span class="n">EndEffector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">end_effector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_step</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_log</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_tolerance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolerance</span><span class="o">.</span><span class="n">joint</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">neighbour_links</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">skin</span><span class="o">.</span><span class="n">use</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skin_point_clouds</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skin</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skin_activations</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activated_skin_points</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activated_skin_normals</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_dir</span><span class="p">,</span> <span class="s2">&quot;iCub/skin/point_clouds/config.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">skin_config</span> <span class="o">=</span> <span class="p">{</span><span class="n">_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()}</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">skin</span><span class="o">.</span><span class="n">skin_parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">skin_pcds</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_dir</span><span class="p">,</span> <span class="s2">&quot;iCub/skin/point_clouds&quot;</span><span class="p">,</span> <span class="s2">&quot;*.pcd&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">skin_pcds</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_dir</span><span class="p">,</span> <span class="s2">&quot;iCub/skin/point_clouds&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_</span><span class="si">}</span><span class="s2">.pcd&quot;</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">skin</span><span class="o">.</span><span class="n">skin_parts</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">pc_path</span> <span class="ow">in</span> <span class="n">skin_pcds</span><span class="p">:</span>
                <span class="c1"># if &quot;leg&quot; not in pc_path:</span>
                <span class="c1">#     continue</span>
                <span class="n">pc</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">pc_path</span><span class="p">)</span>
                <span class="n">pc</span><span class="o">.</span><span class="n">normalize_normals</span><span class="p">()</span>
                <span class="k">if</span> <span class="s2">&quot;foot&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pc_path</span><span class="p">:</span>
                    <span class="n">pc</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">pc</span><span class="o">.</span><span class="n">get_center</span><span class="p">())</span>

                <span class="n">skin_part</span> <span class="o">=</span> <span class="n">skin_config</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">pc_path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skin_point_clouds</span><span class="p">[</span><span class="n">skin_part</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="o">.</span><span class="n">from_legacy</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">o3c</span><span class="o">.</span><span class="n">Dtype</span><span class="o">.</span><span class="n">Float32</span><span class="p">,</span> <span class="n">o3c</span><span class="o">.</span><span class="n">Device</span><span class="p">(</span><span class="s2">&quot;CPU:0&quot;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skin</span><span class="p">[</span><span class="n">skin_part</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pc</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pc</span><span class="o">.</span><span class="n">normals</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skin_activations</span><span class="p">[</span><span class="n">skin_part</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">pc</span><span class="o">.</span><span class="n">points</span><span class="p">),</span> <span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;pycub_file_logger&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
            <span class="n">file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_dir</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span>
                                                            <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span>
                                                            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.csv&quot;</span><span class="p">),</span>
                                               <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
            <span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
            <span class="n">initial_string</span> <span class="o">=</span> <span class="s2">&quot;timestamp;steps_done;&quot;</span><span class="o">+</span><span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">_</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">])</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">skin</span><span class="o">.</span><span class="n">use</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">skin_part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skin_activations</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">initial_string</span> <span class="o">+=</span> <span class="s2">&quot;;&quot;</span><span class="o">+</span><span class="n">skin_part</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">initial_string</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visualizer</span> <span class="o">=</span> <span class="n">Visualizer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_render</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">rtb_links</span><span class="p">,</span> <span class="n">rtb_name</span><span class="p">,</span> <span class="n">rtb_urdf_string</span><span class="p">,</span> <span class="n">rtb_urdf_file_path</span> <span class="o">=</span> <span class="n">rtb</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">Robot</span><span class="o">.</span><span class="n">URDF_read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urdf_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rtb_robot</span> <span class="o">=</span> <span class="n">rtb</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">Robot</span><span class="p">(</span><span class="n">rtb_links</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">rtb_name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">manufacturer</span><span class="o">=</span><span class="s2">&quot;IIT&quot;</span><span class="p">,</span>
                                         <span class="n">urdf_string</span><span class="o">=</span><span class="n">rtb_urdf_string</span><span class="p">,</span> <span class="n">urdf_filepath</span><span class="o">=</span><span class="n">rtb_urdf_file_path</span><span class="p">,)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains_joints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chains</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">collision_during_motion</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_done</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_gravity</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">precomputed_link_ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">precomputed_link_ids</span><span class="p">[</span><span class="n">link</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">robot_link_id</span>

<div class="viewcode-block" id="pyCub.get_chains">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.get_chains">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_chains</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to get chains (and corresponding chains of joints) of the robot</span>

<span class="sd">        :return: chains of links and chains of joints</span>
<span class="sd">        :rtype: dict, dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chains</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left_arm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;chest&#39;</span><span class="p">,</span> <span class="s1">&#39;l_shoulder_1&#39;</span><span class="p">,</span> <span class="s1">&#39;l_shoulder_2&#39;</span><span class="p">,</span> <span class="s1">&#39;l_shoulder_3&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;l_upper_arm&#39;</span><span class="p">,</span> <span class="s1">&#39;l_elbow_1&#39;</span><span class="p">,</span> <span class="s1">&#39;l_forearm&#39;</span><span class="p">,</span> <span class="s1">&#39;l_wrist_1&#39;</span><span class="p">,</span> <span class="s1">&#39;l_hand&#39;</span><span class="p">],</span>
                       <span class="s2">&quot;right_arm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;chest&#39;</span><span class="p">,</span> <span class="s1">&#39;r_shoulder_1&#39;</span><span class="p">,</span> <span class="s1">&#39;r_shoulder_2&#39;</span><span class="p">,</span> <span class="s1">&#39;r_shoulder_3&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;r_upper_arm&#39;</span><span class="p">,</span> <span class="s1">&#39;r_elbow_1&#39;</span><span class="p">,</span> <span class="s1">&#39;r_forearm&#39;</span><span class="p">,</span> <span class="s1">&#39;r_wrist_1&#39;</span><span class="p">,</span> <span class="s1">&#39;r_hand&#39;</span><span class="p">],</span>
                       <span class="s2">&quot;left_leg&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;root_link&#39;</span><span class="p">,</span> <span class="s1">&#39;l_hip_1&#39;</span><span class="p">,</span> <span class="s1">&#39;l_hip_2&#39;</span><span class="p">,</span> <span class="s1">&#39;l_hip_3&#39;</span><span class="p">,</span> <span class="s1">&#39;l_upper_leg&#39;</span><span class="p">,</span> <span class="s1">&#39;l_lower_leg&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;l_ankle_1&#39;</span><span class="p">,</span> <span class="s1">&#39;l_ankle_2&#39;</span><span class="p">,</span> <span class="s1">&#39;l_foot&#39;</span><span class="p">,</span> <span class="s1">&#39;l_foot_dh_frame&#39;</span><span class="p">],</span>
                       <span class="s2">&quot;right_leg&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;root_link&#39;</span><span class="p">,</span> <span class="s1">&#39;r_hip_1&#39;</span><span class="p">,</span> <span class="s1">&#39;r_hip_2&#39;</span><span class="p">,</span> <span class="s1">&#39;r_hip_3&#39;</span><span class="p">,</span> <span class="s1">&#39;r_upper_leg&#39;</span><span class="p">,</span> <span class="s1">&#39;r_lower_leg&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;r_ankle_1&#39;</span><span class="p">,</span> <span class="s1">&#39;r_ankle_2&#39;</span><span class="p">,</span> <span class="s1">&#39;r_foot&#39;</span><span class="p">,</span> <span class="s1">&#39;r_foot_dh_frame&#39;</span><span class="p">],</span>
                       <span class="s2">&quot;head&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;chest&#39;</span><span class="p">,</span> <span class="s1">&#39;neck_1&#39;</span><span class="p">,</span> <span class="s1">&#39;neck_2&#39;</span><span class="p">,</span> <span class="s1">&#39;head&#39;</span><span class="p">],</span>
                       <span class="s2">&quot;torso&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;root_link&#39;</span><span class="p">,</span> <span class="s1">&#39;torso_1&#39;</span><span class="p">,</span> <span class="s1">&#39;torso_2&#39;</span><span class="p">,</span> <span class="s1">&#39;chest&#39;</span><span class="p">]}</span>
        <span class="n">chains_joints</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left_arm&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;l_shoulder_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;l_shoulder_roll&#39;</span><span class="p">,</span> <span class="s1">&#39;l_shoulder_yaw&#39;</span><span class="p">,</span> <span class="s1">&#39;l_arm_ft_sensor&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;l_elbow&#39;</span><span class="p">,</span> <span class="s1">&#39;l_wrist_prosup&#39;</span><span class="p">,</span> <span class="s1">&#39;l_wrist_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;l_wrist_yaw&#39;</span><span class="p">]),</span>
                         <span class="s2">&quot;right_arm&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;r_shoulder_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;r_shoulder_roll&#39;</span><span class="p">,</span> <span class="s1">&#39;r_shoulder_yaw&#39;</span><span class="p">,</span> <span class="s1">&#39;r_arm_ft_sensor&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;r_elbow&#39;</span><span class="p">,</span> <span class="s1">&#39;r_wrist_prosup&#39;</span><span class="p">,</span> <span class="s1">&#39;r_wrist_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;r_wrist_yaw&#39;</span><span class="p">]),</span>
                         <span class="s2">&quot;right_leg&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;r_hip_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;r_hip_roll&#39;</span><span class="p">,</span> <span class="s1">&#39;r_leg_ft_sensor&#39;</span><span class="p">,</span> <span class="s1">&#39;r_hip_yaw&#39;</span><span class="p">,</span> <span class="s1">&#39;r_knee&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;r_ankle_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;r_ankle_roll&#39;</span><span class="p">,</span> <span class="s1">&#39;r_foot_ft_sensor&#39;</span><span class="p">,</span> <span class="s1">&#39;r_foot_dh_frame_fixed_joint&#39;</span><span class="p">]),</span>
                         <span class="s2">&quot;left_leg&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;l_hip_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;l_hip_roll&#39;</span><span class="p">,</span> <span class="s1">&#39;l_leg_ft_sensor&#39;</span><span class="p">,</span> <span class="s1">&#39;l_hip_yaw&#39;</span><span class="p">,</span> <span class="s1">&#39;l_knee&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;l_ankle_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;l_ankle_roll&#39;</span><span class="p">,</span> <span class="s1">&#39;l_foot_ft_sensor&#39;</span><span class="p">,</span> <span class="s1">&#39;l_foot_dh_frame_fixed_joint&#39;</span><span class="p">]),</span>
                         <span class="s2">&quot;head&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;neck_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;neck_roll&#39;</span><span class="p">,</span> <span class="s1">&#39;neck_yaw&#39;</span><span class="p">]),</span>
                         <span class="s2">&quot;torso&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;torso_pitch&#39;</span><span class="p">,</span> <span class="s1">&#39;torso_roll&#39;</span><span class="p">,</span> <span class="s1">&#39;torso_yaw&#39;</span><span class="p">])}</span>
        <span class="k">return</span> <span class="n">chains</span><span class="p">,</span> <span class="n">chains_joints</span></div>


<div class="viewcode-block" id="pyCub.compute_jacobian">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.compute_jacobian">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compute_jacobian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chain</span><span class="p">:</span> <span class="n">CHAINS</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Help function to compute a Jacobian using RTB of a given chain with optional start and end</span>

<span class="sd">        :param chain: name of the chain</span>
<span class="sd">        :type chain: str</span>
<span class="sd">        :param start: name of the start link</span>
<span class="sd">        :type start: str</span>
<span class="sd">        :param end: name of the end link</span>
<span class="sd">        :type end: str</span>
<span class="sd">        :return: Jacobian and list of joints used</span>
<span class="sd">        :rtype: np.array, np.array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="n">chain</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="n">chain</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">end_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">end_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="n">chain</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_joint_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chains_joints</span><span class="p">[</span><span class="n">chain</span><span class="p">],</span> <span class="n">allow_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="n">end_id</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtb_robot</span><span class="o">.</span><span class="n">jacob0</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">start</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains_joints</span><span class="p">[</span><span class="n">chain</span><span class="p">][:</span><span class="n">end_id</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="pyCub.get_camera_images">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.get_camera_images">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_camera_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eyes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the images from enabled eye cameras</span>

<span class="sd">        :param eyes: name of eye/eyes to get images for</span>
<span class="sd">        :type eyes: str or list of str, optional</span>
<span class="sd">        :return: dictionary with eye as keys and np.array of images as values</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">eyes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eyes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualizer</span><span class="o">.</span><span class="n">eye_windows</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eyes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">eyes</span> <span class="o">=</span> <span class="p">[</span><span class="n">eyes</span><span class="p">]</span>

        <span class="n">images</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">eye</span> <span class="ow">in</span> <span class="n">eyes</span><span class="p">:</span>
            <span class="n">ew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualizer</span><span class="o">.</span><span class="n">eye_windows</span><span class="p">[</span><span class="n">eye</span><span class="p">]</span>
            <span class="n">images</span><span class="p">[</span><span class="n">ew</span><span class="o">.</span><span class="n">eye</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ew</span><span class="o">.</span><span class="n">last_image</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">images</span></div>


<div class="viewcode-block" id="pyCub.get_camera_depth_images">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.get_camera_depth_images">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_camera_depth_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eyes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the images from enabled eye cameras</span>

<span class="sd">        :param eyes: name of eye/eyes to get images for</span>
<span class="sd">        :type eyes: str or list of str, optional</span>
<span class="sd">        :return: dictionary with eye as keys and np.array of images as values</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">eyes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eyes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualizer</span><span class="o">.</span><span class="n">eye_windows</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eyes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">eyes</span> <span class="o">=</span> <span class="p">[</span><span class="n">eyes</span><span class="p">]</span>

        <span class="n">images</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">eye</span> <span class="ow">in</span> <span class="n">eyes</span><span class="p">:</span>
            <span class="n">ew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualizer</span><span class="o">.</span><span class="n">eye_windows</span><span class="p">[</span><span class="n">eye</span><span class="p">]</span>
            <span class="n">images</span><span class="p">[</span><span class="n">ew</span><span class="o">.</span><span class="n">eye</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ew</span><span class="o">.</span><span class="n">last_depth_image</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">images</span></div>


<div class="viewcode-block" id="pyCub.find_processes_by_name">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.find_processes_by_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_processes_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Help function to find PIDs of processes with the parent name</span>

<span class="sd">        :return: list of matching PIDs</span>
<span class="sd">        :rtype: list of ints</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matching_pids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">process</span> <span class="ow">in</span> <span class="n">psutil</span><span class="o">.</span><span class="n">process_iter</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;cmdline&#39;</span><span class="p">]):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_name</span> <span class="ow">in</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;cmdline&#39;</span><span class="p">]):</span>
                    <span class="n">matching_pids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">matching_pids</span></div>


<div class="viewcode-block" id="pyCub.kill_open3d">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.kill_open3d">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">kill_open3d</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A bit of a workaround to kill open3d, that seems to hang for some reason.</span>

<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_processes_by_name</span><span class="p">():</span>
            <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span></div>



<div class="viewcode-block" id="pyCub.init_robot">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.init_robot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">init_robot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Joint</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Link</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the robot URDF and get its joints&#39; information</span>

<span class="sd">        :return: robot, its joints and links</span>
<span class="sd">        :rtype: int, list of Joint, list of Link</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">self_collisions</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">self_collisions</span><span class="p">:</span>
            <span class="n">robot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadURDF</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urdf_path</span><span class="p">,</span> <span class="n">useFixedBase</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">URDF_USE_SELF_COLLISION</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">robot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadURDF</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urdf_path</span><span class="p">,</span> <span class="n">useFixedBase</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># get all moveable joints</span>
        <span class="n">joints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNumJoints</span><span class="p">(</span><span class="n">robot</span><span class="p">)):</span>
            <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getJointInfo</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="n">joint</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jointInfo</span><span class="p">[</span><span class="s2">&quot;TYPE&quot;</span><span class="p">]]</span> <span class="o">!=</span> <span class="n">p</span><span class="o">.</span><span class="n">JOINT_FIXED</span><span class="p">:</span>
                <span class="n">joint</span> <span class="o">=</span> <span class="n">Joint</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jointInfo</span><span class="p">[</span><span class="s2">&quot;NAME&quot;</span><span class="p">]],</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">),</span> <span class="n">info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jointInfo</span><span class="p">[</span><span class="s2">&quot;INDEX&quot;</span><span class="p">]],</span> <span class="nb">len</span><span class="p">(</span><span class="n">joints</span><span class="p">),</span>
                              <span class="n">info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jointInfo</span><span class="p">[</span><span class="s2">&quot;LOWERLIMIT&quot;</span><span class="p">]],</span> <span class="n">info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jointInfo</span><span class="p">[</span><span class="s2">&quot;UPPERLIMIT&quot;</span><span class="p">]],</span>
                              <span class="n">info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jointInfo</span><span class="p">[</span><span class="s2">&quot;MAXFORCE&quot;</span><span class="p">]],</span> <span class="n">info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jointInfo</span><span class="p">[</span><span class="s2">&quot;MAXVELOCITY&quot;</span><span class="p">]])</span>
                <span class="n">joints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">joint</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">initial_joint_angles</span><span class="p">,</span> <span class="n">joint</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">resetJointState</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="n">joint</span><span class="o">.</span><span class="n">robot_joint_id</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">initial_joint_angles</span><span class="p">,</span> <span class="n">joint</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>

        <span class="c1"># get all links with collision geometry (these are usually able to move)</span>
        <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">urdfs</span><span class="p">[</span><span class="s2">&quot;robot&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="s2">&quot;collision&quot;</span><span class="p">):</span>
                <span class="n">link_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_link_id</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">collision</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">robot</span><span class="o">=</span><span class="n">robot</span><span class="p">)</span>
                <span class="n">link</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">link_id</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
                <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_urdfs</span><span class="p">()</span>

        <span class="c1"># perform one step of collision detection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepSimulation</span><span class="p">()</span>
        <span class="c1"># get all collisions</span>
        <span class="n">self_collisions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContactPoints</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="n">robot</span><span class="p">)</span>
        <span class="c1"># disable collision for all links in collision -&gt; these links should be in collision by default, so we need</span>
        <span class="c1"># to disable checks for them</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">self_collisions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCollisionFilterPair</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="n">robot</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">robot</span><span class="p">,</span> <span class="n">joints</span><span class="p">,</span> <span class="n">links</span></div>


<div class="viewcode-block" id="pyCub.init_urdfs">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.init_urdfs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">init_urdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to load URDFs of other objects</span>

<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;urdfs&quot;</span><span class="p">):</span>
            <span class="c1"># for object_id, urdf path, whether it should be fixed and the color</span>
            <span class="k">for</span> <span class="n">obj_id</span><span class="p">,</span> <span class="n">urdf</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">urdfs</span><span class="o">.</span><span class="n">paths</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">urdfs</span><span class="o">.</span><span class="n">paths</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">urdfs</span><span class="o">.</span><span class="n">fixed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">urdfs</span><span class="o">.</span><span class="n">color</span><span class="p">):</span>
                <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                <span class="c1"># if obj file, convert it to URDF (and, optionaly, add suffix so the same .obj can be used multiple times)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">urdf</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;obj&quot;</span><span class="p">:</span>
                    <span class="n">obj_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">urdf</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">while</span> <span class="n">obj_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">urdfs</span><span class="p">:</span>
                        <span class="n">suffix</span> <span class="o">+=</span> <span class="s2">&quot;_&quot;</span>
                        <span class="n">obj_name</span> <span class="o">=</span> <span class="n">obj_name</span><span class="o">+</span><span class="n">suffix</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">create_urdf</span><span class="p">(</span><span class="n">urdf</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
                    <span class="n">urdf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_dir</span><span class="p">,</span> <span class="s2">&quot;other_meshes&quot;</span><span class="p">,</span> <span class="n">urdf</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.obj&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">+</span><span class="s2">&quot;.urdf&quot;</span><span class="p">)))</span>
                <span class="c1"># if URDF, just load it</span>
                <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">urdf</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;urdf&quot;</span><span class="p">:</span>
                    <span class="n">urdf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_dir</span><span class="p">,</span> <span class="s2">&quot;other_meshes&quot;</span><span class="p">,</span> <span class="n">urdf</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Objects must be .obj or .urdf!&quot;</span><span class="p">)</span>
                <span class="c1"># Parse the URDF</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">urdfs</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">urdf</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">URDF</span><span class="p">(</span><span class="n">urdf</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">urdfs</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="n">obj_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">urdf</span>

        <span class="c1"># RUN vhacd on the URDF objects if required</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vhacd</span><span class="o">.</span><span class="n">use_vhacd</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_vhacd</span><span class="p">(</span><span class="n">robot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;urdfs&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">urdf_id</span><span class="p">,</span> <span class="n">urdf</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">fixed</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">urdfs</span><span class="o">.</span><span class="n">paths</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">urdfs</span><span class="o">.</span><span class="n">paths</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">urdfs</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">urdfs</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">urdfs</span><span class="o">.</span><span class="n">fixed</span><span class="p">):</span>
                <span class="n">obj_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">urdf</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">urdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">urdfs</span><span class="p">[</span><span class="n">obj_name</span><span class="p">]</span><span class="o">.</span><span class="n">path</span>
                <span class="c1"># apped to other objects list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">other_objects</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">loadURDF</span><span class="p">(</span><span class="n">urdf</span><span class="p">,</span> <span class="n">pos</span><span class="p">),</span> <span class="n">obj_name</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">urdf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;other_meshes/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.urdf&quot;</span><span class="p">,</span> <span class="s2">&quot;.obj&quot;</span><span class="p">)))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fixed</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">free_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">other_objects</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1"># Put the specified force (or 0.25N) to each joint so the objects moves &quot;naturally&quot;</span>
                <span class="n">f</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">urdfs</span><span class="p">,</span> <span class="s2">&quot;force&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">urdfs</span><span class="o">.</span><span class="n">force</span><span class="p">[</span><span class="n">urdf_id</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNumJoints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">other_objects</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setJointMotorControl2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">other_objects</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">joint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">POSITION_CONTROL</span><span class="p">,</span> <span class="n">targetPosition</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                               <span class="n">targetVelocity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">f</span><span class="p">)</span></div>


<div class="viewcode-block" id="pyCub.is_alive">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.is_alive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_alive</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether the engine is still running</span>

<span class="sd">        :return: True when running</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualizer</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="pyCub.update_simulation">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.update_simulation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sleep_duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the simulation</span>

<span class="sd">        :param sleep_duration: duration to sleep before the next simulation step</span>
<span class="sd">        :type sleep_duration: float or None, optional, default=-1</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">sleep_duration</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">sleep_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_step</span>

        <span class="c1"># This is here to keep events and everything in open3D work even if we want slower simulation</span>
        <span class="n">cur_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sleep_duration</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cur_time</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">last_step</span> <span class="o">&gt;</span> <span class="n">sleep_duration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stepSimulation</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">skin</span><span class="o">.</span><span class="n">use</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compute_skin</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_step</span> <span class="o">=</span> <span class="n">cur_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">steps_done</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">log</span> <span class="ow">and</span> <span class="n">cur_time</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">last_log</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">period</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepare_log</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_log</span> <span class="o">=</span> <span class="n">cur_time</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_pose</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pose_logger</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_effector</span><span class="o">.</span><span class="n">get_position</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="ow">and</span> <span class="n">cur_time</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">last_render</span> <span class="o">&gt;</span> <span class="mf">0.01</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualizer</span><span class="o">.</span><span class="n">is_alive</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visualizer</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_render</span> <span class="o">=</span> <span class="n">cur_time</span></div>


<div class="viewcode-block" id="pyCub.toggle_gravity">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.toggle_gravity">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">toggle_gravity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggles the gravity</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gravity</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gravity</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setGravity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gravity</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setGravity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destructor to make sure the engine is closed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

<div class="viewcode-block" id="pyCub.scale_bbox">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.scale_bbox">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">scale_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scale an axis-aligned bounding box around its center.</span>

<span class="sd">        :param bbox: sequence (min, max)</span>
<span class="sd">        :type bbox: list|tuple</span>
<span class="sd">        :param scale: scale factor (&gt;0)</span>
<span class="sd">        :type scale: float</span>
<span class="sd">        :return: (min, max) as numpy arrays</span>
<span class="sd">        :rtype: np.array, np.array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;scale must be positive&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bbox must be a sequence of two elements: (min, max)&quot;</span><span class="p">)</span>

        <span class="n">bmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">bmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># center and half extents; scale half extents directly for an axis-aligned box</span>
        <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">bmin</span> <span class="o">+</span> <span class="n">bmax</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">half</span> <span class="o">=</span> <span class="p">(</span><span class="n">bmax</span> <span class="o">-</span> <span class="n">bmin</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">new_half</span> <span class="o">=</span> <span class="n">half</span> <span class="o">*</span> <span class="n">scale</span>

        <span class="k">return</span> <span class="n">center</span> <span class="o">-</span> <span class="n">new_half</span><span class="p">,</span> <span class="n">center</span> <span class="o">+</span> <span class="n">new_half</span></div>


<div class="viewcode-block" id="pyCub.bbox_overlap">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.bbox_overlap">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bbox_overlap</span><span class="p">(</span><span class="n">b1_min</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">b1_max</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">b2_min</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">b2_max</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to check whether two bounding boxes overlap</span>

<span class="sd">        :param b1_min: min bbox 1</span>
<span class="sd">        :type b1_min: list</span>
<span class="sd">        :param b1_max: max bbox 1</span>
<span class="sd">        :type b1_max: list</span>
<span class="sd">        :param b2_min: min bbox 2</span>
<span class="sd">        :type b2_min: list</span>
<span class="sd">        :param b2_max: max bbox 2</span>
<span class="sd">        :type b2_max: list</span>
<span class="sd">        :return: whether the boxes overlap</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">min1</span><span class="p">,</span> <span class="n">max1</span><span class="p">,</span> <span class="n">min2</span><span class="p">,</span> <span class="n">max2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">b1_min</span><span class="p">,</span> <span class="n">b1_max</span><span class="p">,</span> <span class="n">b2_min</span><span class="p">,</span> <span class="n">b2_max</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">min1</span> <span class="o">&gt;=</span> <span class="n">max2</span> <span class="ow">or</span> <span class="n">min2</span> <span class="o">&gt;=</span> <span class="n">max1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="pyCub.compute_skin">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.compute_skin">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compute_skin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to emulate skin activations using ray casting.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">points</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">normals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">links_to_test</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;l_hand&quot;</span><span class="p">,</span> <span class="s2">&quot;r_hand&quot;</span><span class="p">,</span> <span class="s2">&quot;l_forearm&quot;</span><span class="p">,</span> <span class="s2">&quot;r_forearm&quot;</span><span class="p">,</span> <span class="s2">&quot;l_upper_arm&quot;</span><span class="p">,</span> <span class="s2">&quot;r_upper_arm&quot;</span><span class="p">,</span> <span class="s2">&quot;chest&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;l_upper_leg&quot;</span><span class="p">,</span> <span class="s2">&quot;r_upper_leg&quot;</span><span class="p">,</span> <span class="s2">&quot;l_lower_leg&quot;</span><span class="p">,</span> <span class="s2">&quot;r_lower_leg&quot;</span><span class="p">,</span> <span class="s2">&quot;l_foot&quot;</span><span class="p">,</span> <span class="s2">&quot;r_foot&quot;</span><span class="p">,</span> <span class="s2">&quot;head&quot;</span><span class="p">]</span>


        <span class="c1"># Get all overlapping bboxes for robot with robot</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">links_to_test</span><span class="p">:</span>
            <span class="c1"># Make the bboxes smaller as bullet makes them bigger by default</span>
            <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getAABB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precomputed_link_ids</span><span class="p">[</span><span class="n">l</span><span class="p">]),</span> <span class="mf">0.8</span><span class="p">))</span>

        <span class="c1"># Get all overlapping bboxes for robot with free objects</span>
        <span class="k">for</span> <span class="n">fo_id</span><span class="p">,</span> <span class="n">fo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">other_objects</span><span class="p">):</span>
            <span class="c1"># Make the bboxes smaller as bullet makes them bigger by default</span>
            <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getAABB</span><span class="p">(</span><span class="n">fo</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.8</span><span class="p">))</span>
            <span class="n">links_to_test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;other_object_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fo_id</span><span class="p">))</span>

        <span class="c1"># All allowed collisions -&gt; usually neighbouring links that cannot touch</span>
        <span class="n">allowed_collisions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;r_hand&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;r_hand&quot;</span><span class="p">,</span> <span class="s2">&quot;r_forearm&quot;</span><span class="p">],</span> <span class="s2">&quot;r_upper_leg&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;r_lower_leg&quot;</span><span class="p">,</span> <span class="s2">&quot;r_upper_leg&quot;</span><span class="p">,</span> <span class="s2">&quot;r_foot&quot;</span><span class="p">],</span>
                              <span class="s2">&quot;l_forearm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;l_hand&quot;</span><span class="p">,</span> <span class="s2">&quot;l_forearm&quot;</span><span class="p">,</span> <span class="s2">&quot;l_upper_arm&quot;</span><span class="p">],</span>
                              <span class="s2">&quot;l_upper_leg&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;l_lower_leg&quot;</span><span class="p">,</span> <span class="s2">&quot;l_upper_leg&quot;</span><span class="p">,</span> <span class="s2">&quot;l_foot&quot;</span><span class="p">],</span>
                              <span class="s2">&quot;chest&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;l_upper_arm&quot;</span><span class="p">,</span> <span class="s2">&quot;r_upper_arm&quot;</span><span class="p">,</span> <span class="s2">&quot;chest&quot;</span><span class="p">,</span> <span class="s2">&quot;head&quot;</span><span class="p">],</span>
                              <span class="s2">&quot;r_upper_arm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;r_upper_arm&quot;</span><span class="p">,</span> <span class="s2">&quot;r_forearm&quot;</span><span class="p">,</span> <span class="s2">&quot;chest&quot;</span><span class="p">,</span> <span class="s2">&quot;head&quot;</span><span class="p">],</span> <span class="s2">&quot;r_foot&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;r_foot&quot;</span><span class="p">,</span> <span class="s2">&quot;r_upper_leg&quot;</span><span class="p">,</span> <span class="s2">&quot;r_lower_leg&quot;</span><span class="p">],</span>
                              <span class="s2">&quot;l_foot&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;l_foot&quot;</span><span class="p">,</span> <span class="s2">&quot;l_upper_leg&quot;</span><span class="p">,</span> <span class="s2">&quot;l_lower_leg&quot;</span><span class="p">],</span> <span class="s2">&quot;l_upper_arm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;l_upper_arm&quot;</span><span class="p">,</span> <span class="s2">&quot;l_forearm&quot;</span><span class="p">,</span> <span class="s2">&quot;chest&quot;</span><span class="p">,</span> <span class="s2">&quot;head&quot;</span><span class="p">],</span>
                              <span class="s2">&quot;r_lower_leg&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;r_lower_leg&quot;</span><span class="p">,</span> <span class="s2">&quot;r_upper_leg&quot;</span><span class="p">,</span> <span class="s2">&quot;r_foot&quot;</span><span class="p">],</span> <span class="s2">&quot;l_lower_leg&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;l_lower_leg&quot;</span><span class="p">,</span> <span class="s2">&quot;l_upper_leg&quot;</span><span class="p">,</span> <span class="s2">&quot;l_foot&quot;</span><span class="p">],</span>
                              <span class="s2">&quot;r_forearm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;r_hand&quot;</span><span class="p">,</span> <span class="s2">&quot;r_forearm&quot;</span><span class="p">,</span> <span class="s2">&quot;r_upper_arm&quot;</span><span class="p">],</span> <span class="s2">&quot;l_hand&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;l_hand&quot;</span><span class="p">,</span> <span class="s2">&quot;l_forearm&quot;</span><span class="p">],</span>
                              <span class="s2">&quot;head&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;head&quot;</span><span class="p">,</span> <span class="s2">&quot;chest&quot;</span><span class="p">,</span> <span class="s2">&quot;l_upper_arm&quot;</span><span class="p">,</span> <span class="s2">&quot;r_upper_arm&quot;</span><span class="p">]}</span>

        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">R_ori</span> <span class="o">=</span> <span class="n">R</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>

        <span class="n">idxs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precomputed_link_ids</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precomputed_link_ids</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


        <span class="n">link_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLinkStates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">computeLinkVelocity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">computeForwardKinematics</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># for every skin part</span>
        <span class="k">for</span> <span class="n">skin_part</span><span class="p">,</span> <span class="n">pc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skin</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">use_skin</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># deactivate from the last run</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skin_activations</span><span class="p">[</span><span class="n">skin_part</span><span class="p">]</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activated_skin_points</span><span class="p">[</span><span class="n">skin_part</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activated_skin_normals</span><span class="p">[</span><span class="n">skin_part</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">robot_link_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precomputed_link_ids</span><span class="p">[</span><span class="n">skin_part</span><span class="p">]</span>
            <span class="c1"># get position and orientation of the skin patch</span>
            <span class="n">linkState</span> <span class="o">=</span> <span class="n">link_states</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">skin_part</span><span class="p">)]</span>
            <span class="n">ori</span> <span class="o">=</span> <span class="n">linkState</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">linkInfo</span><span class="p">[</span><span class="s2">&quot;URDFORI&quot;</span><span class="p">]]</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">linkState</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">linkInfo</span><span class="p">[</span><span class="s2">&quot;URDFPOS&quot;</span><span class="p">]]</span>


            <span class="n">R_ori</span><span class="o">.</span><span class="n">flat</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMatrixFromQuaternion</span><span class="p">(</span><span class="n">ori</span><span class="p">)</span>
            <span class="n">R</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>

            <span class="c1"># points_ = (R @ np.hstack((pc[0], np.ones((len(pc[0]), 1)))).T)[:3, :].T</span>
            <span class="c1"># normals_ = (R @ np.hstack((pc[1], np.ones((len(pc[0]), 1)))).T)[:3, :].T</span>
            <span class="n">points_</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">@</span> <span class="n">pc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">R</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
            <span class="n">normals_</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">@</span> <span class="n">pc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

            <span class="c1"># create oriented bbox</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">points_</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>  <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">points_</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">bbox_min</span><span class="p">,</span> <span class="n">bbox_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># check for overlaps of skin and object/robot links</span>
            <span class="k">for</span> <span class="n">bb_i</span><span class="p">,</span> <span class="n">bb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bboxes</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_overlap</span><span class="p">(</span><span class="n">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bbox_min</span><span class="p">,</span> <span class="n">bbox_max</span><span class="p">)</span> <span class="ow">and</span> <span class="n">links_to_test</span><span class="p">[</span><span class="n">bb_i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_collisions</span><span class="p">[</span><span class="n">skin_part</span><span class="p">]:</span>
                    <span class="n">use_skin</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_skin</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># if any overlap found compute position and normals of individual sensors</span>
            <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">points</span> <span class="o">=</span> <span class="n">points_</span>
                <span class="n">normals</span> <span class="o">=</span> <span class="n">normals_</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">points</span><span class="p">,</span> <span class="n">points_</span><span class="p">))</span>
                <span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">normals</span><span class="p">,</span> <span class="n">normals_</span><span class="p">))</span>

            <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">robot_link_id</span><span class="p">,</span> <span class="n">skin_part</span><span class="p">,</span> <span class="n">points_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="c1"># if any overlap in total over all skin parts</span>
        <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># raycasting from each sensor to self.config.skin.radius distance</span>
            <span class="n">contacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rayTestBatch</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">points</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">skin</span><span class="o">.</span><span class="n">radius</span><span class="o">*</span><span class="n">normals</span><span class="p">,</span>
                                         <span class="n">numThreads</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">skin</span><span class="o">.</span><span class="n">num_cores</span><span class="p">)</span>
            <span class="n">start_id</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">link_id</span><span class="p">,</span> <span class="n">skin_part</span><span class="p">,</span> <span class="n">num_points</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">:</span>
                <span class="c1"># contacts = intersection of raycast and object</span>
                <span class="k">for</span> <span class="n">c_id</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">contacts</span><span class="p">[</span><span class="n">start_id</span><span class="p">:</span><span class="n">start_id</span><span class="o">+</span><span class="n">num_points</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># the raytestbatch still returns contact event hough there is none</span>
                        <span class="k">continue</span>
                    <span class="c1"># TODO: Fix this somehow more elegant. Some meshes are not smooth and skin collides with it</span>
                    <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">link_id</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">skin_activations</span><span class="p">[</span><span class="n">skin_part</span><span class="p">][</span><span class="n">c_id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">activated_skin_points</span><span class="p">[</span><span class="n">skin_part</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">start_id</span><span class="o">+</span><span class="n">c_id</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">activated_skin_normals</span><span class="p">[</span><span class="n">skin_part</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normals</span><span class="p">[</span><span class="n">start_id</span><span class="o">+</span><span class="n">c_id</span><span class="p">])</span>
                <span class="n">start_id</span> <span class="o">+=</span> <span class="n">num_points</span></div>

            <span class="c1"># for sp in self.skin_activations.keys():</span>
            <span class="c1">#     if np.any(np.isnan(self.activated_skin_points[sp])):</span>
            <span class="c1">#         self.skin_activations[sp].fill(0)</span>
            <span class="c1">#         self.activated_skin_points[sp] = []</span>
            <span class="c1">#         self.activated_skin_normals[sp] = []</span>

<div class="viewcode-block" id="pyCub.prepare_log">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.prepare_log">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_log</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepares the log string</span>

<span class="sd">        :return: log string</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getJointStates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">robot_joint_id</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">])</span>
        <span class="n">joint_states</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">_</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">states</span><span class="p">])</span>

        <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">last_step</span><span class="si">}</span><span class="s2">;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_done</span><span class="si">}</span><span class="s2">;</span><span class="si">{</span><span class="n">joint_states</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">skin</span><span class="o">.</span><span class="n">use</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">skin_part</span><span class="p">,</span> <span class="n">activations</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skin_activations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">activations</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">s</span></div>


<div class="viewcode-block" id="pyCub.move_position">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.move_position">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joints</span><span class="p">:</span> <span class="n">JOINTS</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">JOINTS</span><span class="p">]</span> <span class="o">|</span> <span class="n">JOINTS_IDS</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">JOINTS_IDS</span><span class="p">],</span>
                      <span class="n">positions</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">wait</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                      <span class="n">set_col_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">check_collision</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                      <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the specified joints to the given positions</span>

<span class="sd">        :param joints: joint or list of joints to move</span>
<span class="sd">        :type joints: int, str, list of int, list of str</span>
<span class="sd">        :param positions: position or list of positions to move the joints to</span>
<span class="sd">        :type positions: float or list; same length as joints</span>
<span class="sd">        :param wait: whether to wait until the motion is done</span>
<span class="sd">        :type wait: bool, optional, default=True</span>
<span class="sd">        :param velocity: velocity to move the joints with</span>
<span class="sd">        :type velocity: float, optional, default=1</span>
<span class="sd">        :param set_col_state: whether to reset collision state</span>
<span class="sd">        :type set_col_state: bool, optional, default=True</span>
<span class="sd">        :param check_collision: whether to check for collision during motion</span>
<span class="sd">        :type check_collision: bool, optional, default=True</span>
<span class="sd">        :param timeout: timeout for the motion</span>
<span class="sd">        :type timeout: float, optional, default=10</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if joints is not a list (or iterable in general), make it a list</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">joints</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">joints</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">positions</span><span class="p">]</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="p">[</span><span class="n">joints</span><span class="p">]</span>

        <span class="n">s_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">joint</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">joints</span><span class="p">,</span> <span class="n">positions</span><span class="p">):</span>

            <span class="c1"># find id in robot space from name or id from joint space</span>
            <span class="n">robot_joint_id</span><span class="p">,</span> <span class="n">joint_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_joint_id</span><span class="p">(</span><span class="n">joint</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">lower_limit</span> <span class="o">&lt;=</span> <span class="n">position</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">upper_limit</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Joint </span><span class="si">{</span><span class="n">joint</span><span class="si">}</span><span class="s2"> cannot be moved to </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2"> as it is out of bounds &quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">lower_limit</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">upper_limit</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">lower_limit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">upper_limit</span><span class="p">)</span>
                <span class="c1"># continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">set_point</span> <span class="o">=</span> <span class="n">position</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">s_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setJointMotorControl2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="n">robot_joint_id</span><span class="p">,</span>
                                       <span class="n">controlMode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">POSITION_CONTROL</span><span class="p">,</span> <span class="n">targetPosition</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
                                       <span class="n">force</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">max_force</span><span class="p">,</span>
                                       <span class="n">maxVelocity</span><span class="o">=</span><span class="n">velocity</span><span class="p">)</span>
        <span class="c1"># if set_col_state is True, reset collision state from last movement</span>
        <span class="k">if</span> <span class="n">set_col_state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collision_during_motion</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_motion_done</span><span class="p">(</span><span class="n">check_collision</span><span class="o">=</span><span class="n">check_collision</span><span class="p">)</span></div>


<div class="viewcode-block" id="pyCub.move_velocity">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.move_velocity">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joints</span><span class="p">:</span> <span class="n">JOINTS</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">JOINTS</span><span class="p">]</span> <span class="o">|</span> <span class="n">JOINTS_IDS</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">JOINTS_IDS</span><span class="p">],</span>
                      <span class="n">velocities</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the specified joints with the specified velocity</span>

<span class="sd">        :param joints: joint or list of joints to move</span>
<span class="sd">        :type joints: int or list</span>
<span class="sd">        :param velocities: velocity or list of velocities to move the joints to</span>
<span class="sd">        :type velocities: float or list; same length as joints</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">joints</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">joints</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">velocities</span> <span class="o">=</span> <span class="p">[</span><span class="n">velocities</span><span class="p">]</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="p">[</span><span class="n">joints</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">joint</span><span class="p">,</span> <span class="n">velocity</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">joints</span><span class="p">,</span> <span class="n">velocities</span><span class="p">):</span>

            <span class="n">robot_joint_id</span><span class="p">,</span> <span class="n">joint_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_joint_id</span><span class="p">(</span><span class="n">joint</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">velocity</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">max_velocity</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Joint </span><span class="si">{</span><span class="n">joint</span><span class="si">}</span><span class="s2"> cannot be moved with velocity </span><span class="si">{</span><span class="n">velocity</span><span class="si">}</span><span class="s2"> as it is over the max velocity &quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">max_velocity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setJointMotorControl2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="n">robot_joint_id</span><span class="p">,</span>
                                       <span class="n">controlMode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">VELOCITY_CONTROL</span><span class="p">,</span> <span class="n">targetVelocity</span><span class="o">=</span><span class="n">velocity</span><span class="p">,</span>
                                       <span class="n">force</span><span class="o">=</span><span class="mi">1</span> <span class="k">if</span> <span class="n">velocity</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">100</span><span class="p">,</span>
                                       <span class="n">maxVelocity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">max_velocity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">set_point</span> <span class="o">=</span> <span class="s2">&quot;vel&quot;</span></div>


<div class="viewcode-block" id="pyCub.get_joint_state">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.get_joint_state">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_joint_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joints</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">JOINTS</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">JOINTS</span><span class="p">]</span> <span class="o">|</span> <span class="n">JOINTS_IDS</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">JOINTS_IDS</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">allow_error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the state of the specified joints</span>

<span class="sd">        :param joints: joint or list of joints to get the state of</span>
<span class="sd">        :type joints: int or list, optional, default=None</span>
<span class="sd">        :param allow_error: whether to allow errors (non-existing joints); useful for Jacobian computation</span>
<span class="sd">        :type allow_error: bool, optional, default=False</span>
<span class="sd">        :return: list of states of the joints</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">joints</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="p">[</span><span class="n">joint</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">joints</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">joints</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="p">[</span><span class="n">joints</span><span class="p">]</span>

        <span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">joints</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">robot_joint_id</span><span class="p">,</span> <span class="n">joint_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_joint_id</span><span class="p">(</span><span class="n">joint</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">allow_error</span><span class="p">:</span>
                    <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># add 0; needed for Jacobian that needs all joints, not only moveable ones</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>

            <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getJointState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="n">robot_joint_id</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">jointStates</span><span class="p">[</span><span class="s2">&quot;POSITION&quot;</span><span class="p">]])</span>

        <span class="k">return</span> <span class="n">states</span></div>


<div class="viewcode-block" id="pyCub.motion_done">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.motion_done">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">motion_done</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joints</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">JOINTS</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">JOINTS</span><span class="p">]</span> <span class="o">|</span> <span class="n">JOINTS_IDS</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">JOINTS_IDS</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">check_collision</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether the motion is done.</span>

<span class="sd">        :param joints: joint or list of joints to get the state of</span>
<span class="sd">        :type joints: int or list, optional, default=None</span>
<span class="sd">        :param check_collision: whether to check for collision during motion</span>
<span class="sd">        :type check_collision: bool, optional, default=True</span>
<span class="sd">        :return: True when motion is done, false otherwise</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">joints</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="p">[</span><span class="n">joint</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">joints</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="p">[</span><span class="n">joints</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">check_collision</span><span class="p">:</span>
            <span class="n">contacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContactPoints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contacts</span><span class="p">:</span>
                <span class="c1"># if contact is not with free object (e.g., ball) and is in collision tolerance -&gt; stop</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s2">&quot;IDB&quot;</span><span class="p">]]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">free_objects</span> <span class="ow">and</span> <span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s2">&quot;DISTANCE&quot;</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">collision_tolerance</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">collision_during_motion</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stop_robot</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Collision detected during motion!&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print_collision_info</span><span class="p">()</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="n">cur_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="c1"># check whether all joints are in joint tolerance; if not return False</span>
        <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">joints</span><span class="p">:</span>
            <span class="n">robot_joint_id</span><span class="p">,</span> <span class="n">joint_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_joint_id</span><span class="p">(</span><span class="n">joint</span><span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getJointState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="n">robot_joint_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">set_point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">set_point</span> <span class="o">!=</span> <span class="s2">&quot;vel&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cur_time</span>  <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">start_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">timeout</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stop_robot</span><span class="p">()</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jointStates</span><span class="p">[</span><span class="s2">&quot;POSITION&quot;</span><span class="p">]]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">set_point</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_tolerance</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stop_robot</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="pyCub.wait_motion_done">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.wait_motion_done">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">wait_motion_done</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sleep_duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
                         <span class="n">check_collision</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Help function to wait for motion to be done. Can sleep for a specific duration</span>

<span class="sd">        :param sleep_duration: how long to sleep before running simulation step</span>
<span class="sd">        :type sleep_duration: float, optional, default=0.01</span>
<span class="sd">        :param check_collision: whether to check for collisions during motion</span>
<span class="sd">        :type check_collision: bool, optional, default=True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_done</span><span class="p">(</span><span class="n">check_collision</span><span class="o">=</span><span class="n">check_collision</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_simulation</span><span class="p">(</span><span class="n">sleep_duration</span><span class="p">)</span></div>


<div class="viewcode-block" id="pyCub.stop_robot">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.stop_robot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">stop_robot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joints</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">JOINTS</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">JOINTS</span><span class="p">]</span> <span class="o">|</span> <span class="n">JOINTS_IDS</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="n">JOINTS_IDS</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stops the robot</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">joints</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="p">[</span><span class="n">joint</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">joints</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">joints</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">joints</span> <span class="o">=</span> <span class="p">[</span><span class="n">joints</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">joints</span><span class="p">:</span>
            <span class="n">robot_joint_id</span><span class="p">,</span> <span class="n">joint_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_joint_id</span><span class="p">(</span><span class="n">joint</span><span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getJointState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="n">robot_joint_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">set_point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># I do not know what is the difference now???</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">set_point</span> <span class="o">==</span> <span class="s2">&quot;vel&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">move_velocity</span><span class="p">(</span><span class="n">joint</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">move_position</span><span class="p">(</span><span class="n">joint</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">jointStates</span><span class="p">[</span><span class="s2">&quot;POSITION&quot;</span><span class="p">]],</span> <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">set_col_state</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">set_point</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">[</span><span class="n">joint_id</span><span class="p">]</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="pyCub.move_cartesian">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.move_cartesian">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move_cartesian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">:</span> <span class="n">Pose</span><span class="p">,</span> <span class="n">wait</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                       <span class="n">check_collision</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the robot in cartesian space by computing inverse kinematics and running position control</span>

<span class="sd">        :param pose: desired pose of the end effector</span>
<span class="sd">        :type pose: utils.Pose</span>
<span class="sd">        :param wait: whether to wait for movement completion</span>
<span class="sd">        :type wait: bool, optional, default=True</span>
<span class="sd">        :param velocity: joint velocity to move with</span>
<span class="sd">        :type velocity: float, optional, default=1</span>
<span class="sd">        :param check_collision: whether to check for collisions during motion</span>
<span class="sd">        :type check_collision: bool, optional, default=True</span>
<span class="sd">        :param timeout: timeout for the motion</span>
<span class="sd">        :type timeout: float, optional, default=10</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ik_solution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calculateInverseKinematics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_effector</span><span class="o">.</span><span class="n">link_id</span><span class="p">,</span> <span class="n">pose</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">pose</span><span class="o">.</span><span class="n">ori</span><span class="p">,</span>
                                                               <span class="n">lowerLimits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IK_config</span><span class="p">[</span><span class="s2">&quot;lower_limits&quot;</span><span class="p">],</span>
                                                               <span class="n">upperLimits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IK_config</span><span class="p">[</span><span class="s2">&quot;upper_limits&quot;</span><span class="p">],</span>
                                                               <span class="n">jointRanges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IK_config</span><span class="p">[</span><span class="s2">&quot;joint_ranges&quot;</span><span class="p">],</span>
                                                               <span class="n">restPoses</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IK_config</span><span class="p">[</span><span class="s2">&quot;rest_poses&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IK_config</span><span class="p">[</span><span class="s2">&quot;movable_joints&quot;</span><span class="p">],</span> <span class="n">ik_solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">IK_config</span><span class="p">[</span><span class="s2">&quot;movable_joints&quot;</span><span class="p">]],</span> <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">velocity</span><span class="o">=</span><span class="n">velocity</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_motion_done</span><span class="p">(</span><span class="n">check_collision</span><span class="o">=</span><span class="n">check_collision</span><span class="p">)</span></div>


<div class="viewcode-block" id="pyCub.find_joint_id">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.find_joint_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_joint_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint_name</span><span class="p">:</span> <span class="n">JOINTS</span> <span class="o">|</span> <span class="n">JOINTS_IDS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Help function to get indexes from joint name of joint index in self.joints list</span>

<span class="sd">        :param joint_name: name or index of the link</span>
<span class="sd">        :type joint_name: str or int</span>
<span class="sd">        :return: joint id in pybullet and pycub space</span>
<span class="sd">        :rtype: int, int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">joints</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">joint_name</span> <span class="ow">in</span> <span class="p">[</span><span class="n">joint</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">joint</span><span class="o">.</span><span class="n">joints_id</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">joint</span><span class="o">.</span><span class="n">robot_joint_id</span><span class="p">,</span> <span class="n">joint</span><span class="o">.</span><span class="n">joints_id</span></div>


<div class="viewcode-block" id="pyCub.find_link_id">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.find_link_id">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_link_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">robot</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">urdf_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;robot&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Help function to find link id from mesh name</span>

<span class="sd">        :param mesh_name: name of the mesh (only basename with extension)</span>
<span class="sd">        :type mesh_name: str</span>
<span class="sd">        :param robot: robot pybullet id</span>
<span class="sd">        :type robot: int, optional, default=None</span>
<span class="sd">        :param urdf_name: name of the object in pycub.urdfs</span>
<span class="sd">        :type urdf_name: str, optional, default=&quot;robot&quot;</span>
<span class="sd">        :return: id of the link in pybullet space</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">robot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">robot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span>

        <span class="k">for</span> <span class="n">link_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urdfs</span><span class="p">[</span><span class="n">urdf_name</span><span class="p">]</span><span class="o">.</span><span class="n">links</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCollisionShapeData</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="n">link_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mesh_name</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="n">link_id</span></div>


<div class="viewcode-block" id="pyCub.run_vhacd">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.run_vhacd">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_vhacd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to run VHACD on all objects in loaded URDFs, and to create new URDFs with changed collision meshes</span>

<span class="sd">        :param robot: whether to run VHACD on the robot</span>
<span class="sd">        :type robot: bool, optional, default=True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">something_changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">obj_name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">urdfs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">robot</span> <span class="ow">and</span> <span class="s2">&quot;robot&quot;</span> <span class="ow">in</span> <span class="n">obj_name</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="s2">&quot;collision&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">collision</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="s2">&quot;mesh&quot;</span><span class="p">):</span>
                        <span class="n">col_path_ori</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">collision</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">filename</span>
                        <span class="n">col_path</span> <span class="o">=</span> <span class="n">col_path_ori</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;package://&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="n">col_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_dir</span><span class="p">,</span> <span class="n">col_path</span><span class="p">))</span>
                        <span class="n">vhacd_path</span> <span class="o">=</span> <span class="n">col_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.obj&quot;</span><span class="p">,</span> <span class="s2">&quot;_vhacd.obj&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;visual&quot;</span><span class="p">,</span> <span class="s2">&quot;vhacd&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vhacd</span><span class="o">.</span><span class="n">force_vhacd</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">vhacd_path</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">vhacd</span><span class="p">(</span><span class="n">col_path</span><span class="p">,</span> <span class="n">vhacd_path</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">maxNumVerticesPerCH</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">,</span> <span class="n">concavity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vhacd</span><span class="o">.</span><span class="n">force_vhacd_urdf</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">vhacd_path</span><span class="p">):</span>
                            <span class="n">something_changed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">link</span><span class="o">.</span><span class="n">collision</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">col_path_ori</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;visual&quot;</span><span class="p">,</span> <span class="s2">&quot;vhacd&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.obj&quot;</span><span class="p">,</span> <span class="s2">&quot;_vhacd.obj&quot;</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_fixed&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.urdf&quot;</span><span class="p">,</span> <span class="s2">&quot;_vhacd.urdf&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">something_changed</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">vhacd</span><span class="o">.</span><span class="n">force_vhacd_urdf</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">write_urdf</span><span class="p">()</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">new_urdf</span><span class="p">)</span></div>


<div class="viewcode-block" id="pyCub.create_urdf">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.create_urdf">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_urdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fixed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">color</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">suffix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a URDF for the given .obj file</span>

<span class="sd">        :param object_path: path to the .obj</span>
<span class="sd">        :type object_path: str</span>
<span class="sd">        :param fixed: whether the object is fixed in space</span>
<span class="sd">        :type fixed: bool</span>
<span class="sd">        :param color: color of the object</span>
<span class="sd">        :type color: list of 3 floats</span>
<span class="sd">        :param suffix: suffix to add to the object name</span>
<span class="sd">        :type suffix: str, optional, default=&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_dir</span><span class="p">,</span> <span class="s2">&quot;other_meshes&quot;</span><span class="p">,</span> <span class="s2">&quot;object_default.urdf&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">urdf</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">suffix</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_triangle_mesh</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_dir</span><span class="p">,</span> <span class="s2">&quot;other_meshes&quot;</span><span class="p">,</span> <span class="n">object_path</span><span class="p">)))</span>
        <span class="n">object_path</span> <span class="o">=</span> <span class="n">object_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.obj&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">+</span><span class="s2">&quot;.obj&quot;</span><span class="p">)</span>
        <span class="n">object_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_dir</span><span class="p">,</span> <span class="s2">&quot;other_meshes&quot;</span><span class="p">,</span> <span class="n">object_path</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">suffix</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_triangle_mesh</span><span class="p">(</span><span class="n">object_path</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>

        <span class="n">model_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">object_path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">urdf</span> <span class="o">=</span> <span class="n">urdf</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;OBJECTNAME&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;LATERALFRICTION&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;ROLLINGFRICTION&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;MASS&quot;</span><span class="p">,</span> <span class="s2">&quot;0.2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;FILENAMECOLLISION&quot;</span><span class="p">,</span> <span class="n">object_path</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;FILENAME&quot;</span><span class="p">,</span> <span class="n">object_path</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;VISUALCOLOR&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">color</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">fixed</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_dir</span><span class="p">,</span> <span class="s2">&quot;other_meshes&quot;</span><span class="p">,</span> <span class="s2">&quot;fixed_link.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">fixed_link_text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">urdf</span> <span class="o">=</span> <span class="n">urdf</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;/robot&gt;&quot;</span><span class="p">,</span> <span class="n">fixed_link_text</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">object_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.obj&quot;</span><span class="p">,</span> <span class="s2">&quot;.urdf&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">urdf</span><span class="p">)</span></div>


<div class="viewcode-block" id="pyCub.print_collision_info">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.pyCub.print_collision_info">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">print_collision_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Help function to print collision info</span>

<span class="sd">        :param c: one collision; if None print all collisions</span>
<span class="sd">        :type c: list, optional, default=None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">contacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContactPoints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contacts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_collision_info</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s1">&#39;IDB&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">:</span>
                <span class="n">body_b</span> <span class="o">=</span> <span class="s2">&quot;robot&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">other_objects</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s1">&#39;IDB&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">obj</span><span class="p">:</span>
                        <span class="n">body_b</span> <span class="o">=</span> <span class="n">name</span>
                        <span class="k">break</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">robot_link_id</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s1">&#39;INDEXA&#39;</span><span class="p">]]:</span>
                    <span class="k">break</span>
            <span class="n">link_a</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s1">&#39;IDB&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">robot_link_id</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s1">&#39;INDEXB&#39;</span><span class="p">]]:</span>
                        <span class="k">break</span>
                <span class="n">link_b</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">link_b</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">body_b</span><span class="si">}</span><span class="s2"> link </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s1">&#39;INDEXB&#39;</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Collision of robot with </span><span class="si">{</span><span class="n">body_b</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;Collision of </span><span class="si">{</span><span class="n">link_a</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">link_b</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;Position A: </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s1">&#39;POSITIONA&#39;</span><span class="p">]]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;Position B: </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s1">&#39;POSITIONB&#39;</span><span class="p">]]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;Normal: </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s1">&#39;NORMAL&#39;</span><span class="p">]]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;Distance: </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s1">&#39;DISTANCE&#39;</span><span class="p">]]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;Force: </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s1">&#39;FORCE&#39;</span><span class="p">]]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;Friction 1: </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s1">&#39;FRICTION1&#39;</span><span class="p">]]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;Friction dir 1: </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s1">&#39;FRICTIONDIR1&#39;</span><span class="p">]]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;Friction 2: </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s1">&#39;FRICTION2&#39;</span><span class="p">]]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;Friction dir 2: </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">contactPoints</span><span class="p">[</span><span class="s1">&#39;FRICTIONDIR2&#39;</span><span class="p">]]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="EndEffector">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.EndEffector">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EndEffector</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Help function for end-effector encapsulaation</span>

<span class="sd">        :param name: name of the end-effector</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :param client: parent client</span>
<span class="sd">        :type client: pointer to pyCub instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">urdfs</span><span class="p">[</span><span class="s2">&quot;robot&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">links</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">link_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">find_link_id</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">collision</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
                <span class="k">break</span>

<div class="viewcode-block" id="EndEffector.get_position">
<a class="viewcode-back" href="../../pycub.html#icub_pybullet.pycub.EndEffector.get_position">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pose</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to get current position of the end-effector</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">getLinkState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_id</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">linkInfo</span><span class="p">[</span><span class="s2">&quot;URDFPOS&quot;</span><span class="p">]])</span>
        <span class="n">ori</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">linkInfo</span><span class="p">[</span><span class="s2">&quot;URDFORI&quot;</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">Pose</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">ori</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Lukas Rustler.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>